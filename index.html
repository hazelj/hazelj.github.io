
<!DOCTYPE html>
<html lang="en">
<head>
    
  <title>Medal Tracker</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>

  <style>

    #conference-widget{
        width:600px;
    }

    .fixed_header{
        width: 600px;
        /* table-layout: fixed; */
    }

    .fixed_header tbody{
        display:block;
        width: 100%;
        overflow: auto;
        height: 400px;
    }

    .fixed_header tbody tr{
        height: 0px;
    }
    .fixed_header tbody tr td{
        height: 0px;
    }

    .fixed_header thead {
        display: block;
    }

    .table > tbody > tr > td{
        padding: 0px;
    }

    .accordion-body, a[aria-expanded="true"]{
        padding-left: 25px;
        background-color: lightgray;
    }

    a[aria-expanded="true"]{
        background-color: #42DCA3;
    }

    /* .fixed_header tr.hidden-tr {
        height: 0px;
        line-height: 0px;
        display: hidden;
    } */

    /* .hiddenRow {
        padding: 0 !important;
    } */

    .fixed_header th, .fixed_header td {
        width: 200px;
        /* height: 12px; */
    }

    .fixed_header th {
        text-align: center;
    }

  </style>

<script>

    // var dummyApiResults = [
    //     {'conference': 'pac12', 'total_medals': 10, 'gold': 3, 'silver': 4, 'bronze': 3},
    //     {'conference': 'sec',   'total_medals': 11, 'gold': 4, 'silver': 4, 'bronze': 3},
    //     {'conference': 'acc',   'total_medals': 12, 'gold': 5, 'silver': 4, 'bronze': 3},
    // ];

    var dummyApiResults = {"MedalTableInfo":{"c_AsOfDate":"2018-02-25","n_EventsTotal":102,"n_EventsFinished":102,"n_EventsScheduled":0,"n_MedalsGold":103,"n_MedalsSilver":102,"n_MedalsBronze":102,"n_MedalsTotal":307,"n_SportID":-1,"c_Sport":null,"c_SportShort":null},"MedalTableNOC":[{"n_NOCID":153,"n_NOCGeoID":2221,"c_NOC":"Norway","c_NOCShort":"NOR","n_Gold":14,"n_Silver":14,"n_Bronze":11,"n_Total":39,"n_RankGold":1,"n_RankSortGold":1,"n_RankTotal":1,"n_RankSortTotal":1},{"n_NOCID":2,"n_NOCGeoID":2206,"c_NOC":"Germany","c_NOCShort":"GER","n_Gold":14,"n_Silver":10,"n_Bronze":7,"n_Total":31,"n_RankGold":2,"n_RankSortGold":2,"n_RankTotal":2,"n_RankSortTotal":2},{"n_NOCID":159,"n_NOCGeoID":2231,"c_NOC":"Canada","c_NOCShort":"CAN","n_Gold":11,"n_Silver":8,"n_Bronze":10,"n_Total":29,"n_RankGold":3,"n_RankSortGold":3,"n_RankTotal":3,"n_RankSortTotal":3},{"n_NOCID":5,"n_NOCGeoID":2209,"c_NOC":"United States","c_NOCShort":"USA","n_Gold":9,"n_Silver":8,"n_Bronze":6,"n_Total":23,"n_RankGold":4,"n_RankSortGold":4,"n_RankTotal":4,"n_RankSortTotal":4},{"n_NOCID":1,"n_NOCGeoID":2201,"c_NOC":"Netherlands","c_NOCShort":"NED","n_Gold":8,"n_Silver":6,"n_Bronze":6,"n_Total":20,"n_RankGold":5,"n_RankSortGold":5,"n_RankTotal":5,"n_RankSortTotal":5},{"n_NOCID":154,"n_NOCGeoID":2222,"c_NOC":"Sweden","c_NOCShort":"SWE","n_Gold":7,"n_Silver":6,"n_Bronze":1,"n_Total":14,"n_RankGold":6,"n_RankSortGold":6,"n_RankTotal":10,"n_RankSortTotal":10},{"n_NOCID":106,"n_NOCGeoID":4391,"c_NOC":"South Korea","c_NOCShort":"KOR","n_Gold":5,"n_Silver":8,"n_Bronze":4,"n_Total":17,"n_RankGold":7,"n_RankSortGold":7,"n_RankTotal":6,"n_RankSortTotal":6},{"n_NOCID":149,"n_NOCGeoID":2213,"c_NOC":"Switzerland","c_NOCShort":"SUI","n_Gold":5,"n_Silver":6,"n_Bronze":4,"n_Total":15,"n_RankGold":8,"n_RankSortGold":8,"n_RankTotal":8,"n_RankSortTotal":8},{"n_NOCID":144,"n_NOCGeoID":2202,"c_NOC":"France","c_NOCShort":"FRA","n_Gold":5,"n_Silver":4,"n_Bronze":6,"n_Total":15,"n_RankGold":9,"n_RankSortGold":9,"n_RankTotal":9,"n_RankSortTotal":9},{"n_NOCID":151,"n_NOCGeoID":2219,"c_NOC":"Austria","c_NOCShort":"AUT","n_Gold":5,"n_Silver":3,"n_Bronze":6,"n_Total":14,"n_RankGold":10,"n_RankSortGold":10,"n_RankTotal":11,"n_RankSortTotal":11},{"n_NOCID":18,"n_NOCGeoID":2241,"c_NOC":"Japan","c_NOCShort":"JPN","n_Gold":4,"n_Silver":5,"n_Bronze":4,"n_Total":13,"n_RankGold":11,"n_RankSortGold":11,"n_RankTotal":12,"n_RankSortTotal":12},{"n_NOCID":6,"n_NOCGeoID":2210,"c_NOC":"Italy","c_NOCShort":"ITA","n_Gold":3,"n_Silver":2,"n_Bronze":5,"n_Total":10,"n_RankGold":12,"n_RankSortGold":12,"n_RankTotal":13,"n_RankSortTotal":13},{"n_NOCID":19213,"n_NOCGeoID":63725,"c_NOC":"Olympic Athlete from Russia","c_NOCShort":"OAR","n_Gold":2,"n_Silver":6,"n_Bronze":9,"n_Total":17,"n_RankGold":13,"n_RankSortGold":13,"n_RankTotal":7,"n_RankSortTotal":7},{"n_NOCID":17,"n_NOCGeoID":2240,"c_NOC":"Czech Republic","c_NOCShort":"CZE","n_Gold":2,"n_Silver":2,"n_Bronze":3,"n_Total":7,"n_RankGold":14,"n_RankSortGold":14,"n_RankTotal":15,"n_RankSortTotal":15},{"n_NOCID":103,"n_NOCGeoID":4387,"c_NOC":"Belarus","c_NOCShort":"BLR","n_Gold":2,"n_Silver":1,"n_Bronze":0,"n_Total":3,"n_RankGold":15,"n_RankSortGold":15,"n_RankTotal":18,"n_RankSortTotal":18},{"n_NOCID":26,"n_NOCGeoID":2770,"c_NOC":"China","c_NOCShort":"CHN","n_Gold":1,"n_Silver":6,"n_Bronze":2,"n_Total":9,"n_RankGold":16,"n_RankSortGold":16,"n_RankTotal":14,"n_RankSortTotal":14},{"n_NOCID":14,"n_NOCGeoID":2233,"c_NOC":"Slovakia","c_NOCShort":"SVK","n_Gold":1,"n_Silver":2,"n_Bronze":0,"n_Total":3,"n_RankGold":17,"n_RankSortGold":17,"n_RankTotal":19,"n_RankSortTotal":19},{"n_NOCID":161,"n_NOCGeoID":2237,"c_NOC":"Finland","c_NOCShort":"FIN","n_Gold":1,"n_Silver":1,"n_Bronze":4,"n_Total":6,"n_RankGold":18,"n_RankSortGold":18,"n_RankTotal":16,"n_RankSortTotal":16},{"n_NOCID":211,"n_NOCGeoID":4058,"c_NOC":"Great Britain","c_NOCShort":"GBR","n_Gold":1,"n_Silver":0,"n_Bronze":4,"n_Total":5,"n_RankGold":19,"n_RankSortGold":19,"n_RankTotal":17,"n_RankSortTotal":17},{"n_NOCID":150,"n_NOCGeoID":2214,"c_NOC":"Poland","c_NOCShort":"POL","n_Gold":1,"n_Silver":0,"n_Bronze":1,"n_Total":2,"n_RankGold":20,"n_RankSortGold":20,"n_RankTotal":21,"n_RankSortTotal":21},{"n_NOCID":28,"n_NOCGeoID":2776,"c_NOC":"Hungary","c_NOCShort":"HUN","n_Gold":1,"n_Silver":0,"n_Bronze":0,"n_Total":1,"n_RankGold":21,"n_RankSortGold":21,"n_RankTotal":25,"n_RankSortTotal":25},{"n_NOCID":13,"n_NOCGeoID":2232,"c_NOC":"Ukraine","c_NOCShort":"UKR","n_Gold":1,"n_Silver":0,"n_Bronze":0,"n_Total":1,"n_RankGold":21,"n_RankSortGold":22,"n_RankTotal":25,"n_RankSortTotal":26},{"n_NOCID":157,"n_NOCGeoID":2229,"c_NOC":"Australia","c_NOCShort":"AUS","n_Gold":0,"n_Silver":2,"n_Bronze":1,"n_Total":3,"n_RankGold":23,"n_RankSortGold":23,"n_RankTotal":20,"n_RankSortTotal":20},{"n_NOCID":30,"n_NOCGeoID":2783,"c_NOC":"Slovenia","c_NOCShort":"SLO","n_Gold":0,"n_Silver":1,"n_Bronze":1,"n_Total":2,"n_RankGold":24,"n_RankSortGold":24,"n_RankTotal":22,"n_RankSortTotal":22},{"n_NOCID":147,"n_NOCGeoID":2205,"c_NOC":"Belgium","c_NOCShort":"BEL","n_Gold":0,"n_Silver":1,"n_Bronze":0,"n_Total":1,"n_RankGold":25,"n_RankSortGold":25,"n_RankTotal":27,"n_RankSortTotal":27},{"n_NOCID":158,"n_NOCGeoID":2230,"c_NOC":"New Zealand","c_NOCShort":"NZL","n_Gold":0,"n_Silver":0,"n_Bronze":2,"n_Total":2,"n_RankGold":26,"n_RankSortGold":26,"n_RankTotal":23,"n_RankSortTotal":23},{"n_NOCID":145,"n_NOCGeoID":2203,"c_NOC":"Spain","c_NOCShort":"ESP","n_Gold":0,"n_Silver":0,"n_Bronze":2,"n_Total":2,"n_RankGold":26,"n_RankSortGold":27,"n_RankTotal":23,"n_RankSortTotal":24},{"n_NOCID":160,"n_NOCGeoID":2236,"c_NOC":"Kazakhstan","c_NOCShort":"KAZ","n_Gold":0,"n_Silver":0,"n_Bronze":1,"n_Total":1,"n_RankGold":28,"n_RankSortGold":28,"n_RankTotal":28,"n_RankSortTotal":28},{"n_NOCID":9,"n_NOCGeoID":2218,"c_NOC":"Latvia","c_NOCShort":"LAT","n_Gold":0,"n_Silver":0,"n_Bronze":1,"n_Total":1,"n_RankGold":28,"n_RankSortGold":29,"n_RankTotal":28,"n_RankSortTotal":29},{"n_NOCID":167,"n_NOCGeoID":2247,"c_NOC":"Liechtenstein","c_NOCShort":"LIE","n_Gold":0,"n_Silver":0,"n_Bronze":1,"n_Total":1,"n_RankGold":28,"n_RankSortGold":30,"n_RankTotal":28,"n_RankSortTotal":30}]};

    var lorem = "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.";

    var TOP_F='MedalTableNOC';
    var CONF_F='c_NOC';//'conference';
    var TOT_F='n_Total';
    var GOLD_F='n_Gold';
    var SILV_F='n_Silver';
    var BRNZ_F='n_Bronze';
    var SPORT_F='sport';
    var SCHOOL_F='school';

    var MAX_COL_CHARS = 20;

    function getAndFillWithData(selector){

        var mw_cols = [ ['Conference', CONF_F], ['Total Medals', TOT_F], ['Gold', GOLD_F], ['Silver', SILV_F], ['Bronze', BRNZ_F] ];
        var sub_col_names = ['School', 'Medalist', 'Sport', 'Event', ];

        addHeader(selector, mw_cols);
        var menuOptions = buildTable(selector, mw_cols, dummyApiResults[TOP_F], 'conference');
        buildMenus(menuOptions);
    }

    function buildMenus(menuOptions){

        var conferenceOpts = Array.from(menuOptions[CONF_F]);

        for (var i = 0; i < conferenceOpts.length; i++) {
            var tVal = conferenceOpts[i];
            console.log(tVal);
            var tLI = $(`<li/>`);
            var tA = $(`<a href="#"/>`).html(
                tVal.toString().substring(0, MAX_COL_CHARS)
            );
            tLI.append(tA);
            $('#conference-dropdown').append(tLI);
        }
        
    }

    // Builds the Table out of apiResults.
    function buildTable(selector, mw_cols, apiResults, name) {

        var menuOptions = {};
        menuOptions[CONF_F  ] = new Set();
        menuOptions[SPORT_F ] = new Set();
        menuOptions[SCHOOL_F] = new Set();

        tBody = $('<tbody />');//' style="height:450px; overflow: auto;" />')

        // <tr data-toggle="collapse" data-target="#demo1" class="accordion-toggle">
        //     <td>1</td>
        //     <td>05 May 2013</td>
        //     <td>Credit Account</td>
        //     <td class="text-success">$150.00</td>
        //     <td class="text-error"></td>
        //     <td class="text-success">$150.00</td>
        // </tr>

        // <tr>
        //     <td colspan="6" class="hiddenRow">
        //         <div class="accordion-body collapse" id="demo1">Demo1</div>
        //     </td>
        // </tr>

        for (var i = 0; i < apiResults.length; i++) {
            var tTarget = name + '-row-' + i.toString();
            var tRow = $(`<tr data-toggle="collapse" data-target="#${tTarget}" class="accordion-toggle"/>`);
            var result = apiResults[i];
            for(var j = 0; j < mw_cols.length; j++){

                var tKey = mw_cols[j][1];
                var tVal = result[tKey];

                if(tKey in menuOptions){
                    menuOptions[tKey].add(tVal);
                }

                var tdclass = tKey == CONF_F ? "text-left" : "text-center";
                var tTD = $(`<td class="${tdclass}"/>`).html(
                    tVal.toString().substring(0, MAX_COL_CHARS)
                );
                tRow.append(tTD);
            }

            var tHiddenRow = $('<tr class="hidden-tr"/>');
            var tHiddenD = $('<td colspan="6" class="hiddenRow"/>');
            var tHiddenDiv = $(`<div class="accordion-body collapse" id="${tTarget}">${lorem}</div>`);
            tHiddenD.append(tHiddenDiv);
            tHiddenRow.append(tHiddenD);
            tBody.append(tRow);

            tBody.append(tHiddenRow);
        }
        $(selector).append(tBody);
        return menuOptions;
    }

    function addHeader(selector, col_names) {
        var tHead = $('<thead/>');
        var tR = $('<tr/>');

        for (var i = 0; i < col_names.length; i++) {
            tR.append($('<th/>').html(capitalize(col_names[i][0])));
        }

        tHead.append(tR);
        $(selector).append(tHead);
        return col_names;
    }

    function capitalize(mystr){
        return mystr.charAt(0).toUpperCase() + mystr.slice(1)
    }
        
</script> 
</head>

<body onLoad="getAndFillWithData('#medalTable')">
    <div class="container" id="conference-widget">
        <h2>Medal Count</h2>

        <div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">
            <div class="btn-group mr-2" role="group" aria-label="conference">
                <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">
                    Conference
                <span class="caret"></span></button>
                <ul class="dropdown-menu" id="conference-dropdown">
                </ul>
            </div>
            <div class="btn-group mr-2" role="group" aria-label="sport">
                <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">
                    Sport
                <span class="caret"></span></button>
                <ul class="dropdown-menu">
                    <li><a href="#">Golf</a></li>
                    <li><a href="#">Swimming</a></li>
                    <li><a href="#">Triathalon</a></li>
                </ul>
            </div>
            <div class="btn-group mr-2" role="group" aria-label="gender">
                <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">
                    Gender
                <span class="caret"></span></button>
                <ul class="dropdown-menu">
                    <li><a href="#">Men</a></li>
                    <li><a href="#">Women</a></li>
                </ul>
            </div>
            <div class="btn-group mr-4" role="group" aria-label="school">
                <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">
                    School
                <span class="caret"></span></button>
                <ul class="dropdown-menu">
                    <li><a href="#">Oregon</a></li>
                    <li><a href="#">Oregon State</a></li>
                    <li><a href="#">U.B.</a></li>
                </ul>
            </div>
        </div>
              
        <div>
            <table class="table fixed_header" id="medalTable" ></table>
        </div>
        
    </div>
</body>

</html>
